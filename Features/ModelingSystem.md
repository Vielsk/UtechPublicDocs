# Моделирование и механизмы

- [Основное меню](../README.md)

## Математические модели

Определенные тайлы или предметы имеют "математическую модель", которая с заданным интервалом времени (циклом дискретизации) выполняет алгоритм, который может изменять значение переменных модели, изменять параметры тайлов и предметов, выполнять рецепты, взаимодействовать с миром и т.д., модель может иметь одно или несколько пространств для хранения предметов ("инвентарей"). С помощью моделей реализуются механизмы и сложные предметы. В алгоритме могут использоваться схожие с реальными динамические звенья (интегрирующее, дифференцирующие, инерционное и т.д.), поведение которых рассчитывается через рекуррентные соотношения, подобно тому как это происходит в цифровых системах управления. Модели могут быть комплексными и содержать внутри себя дочерние модели, также выполняющие определенный алгоритм. Модели могут быть подвержены влиянию окружающей среды, например температуры, солнечному свету, ветру и т.д., что позволяет реализовывать солнечные панели, ветряки и другие механизмы, которым необходима информация об окружающем мире.

Модель разделена на ядро модели (ModelCore) определяющее её тип и реализующее алгоритм, выполняемый моделью, и вариацию модели ("ModelVariation"), которая описывает численные параметры модели (например КПД, производительность, количество доступного места в хранилище). У одного типа моделей может быть несколько вариаций (например маленький костер, большой костер, каменная печь у модели с ядром твердотопливная печ). Ядро модели "захардкожено" для повышения производительности, а вариации модели создаются и изменяются в контент-паке.

ModelCore может реализовывать определенные интерфейсы для взаимодействия с другими моделями (например IEnergySource, IEnergyConsumer, IPipe и т.п.). Модель получить информацию о других моделях в мире и взаимодействовать с ними через подобные интерфейсы во время выполнения алгоритма, заложенного в модель.  

## Моделирование предметов в хранилищах

Все предметы также подвергаются постоянному моделированию: производится расчет итоговой температуры предметов с учетом рассеянного и подведенного к ним тепла, рассчитываются тепловые переходы (выполняются рецепты из групп "heating" и "cooling"). Некоторые предметы могут разрушаться со временем, величина их износа увеличивается на определённую величину со временем и при достижении 1.0 происходит выполнение рецепта из группы "destruction", либо удаление таких предметов, если рецептов для них нет.

## Механизмы

Механизмы являются тайлами с моделью и предназначены для выполнения какой-либо работы, подобно механизмам из GregTech или Factorio. Механизмы могут быть как одно-тайловыми, так и много-тайловыми (подобно тому как реализованы многоблочные механизмы в GregTech), такие механизмы сложнее в производстве и обслуживании, но позволяют выполнять уникальные рецепты.

Механизмы могут иметь разный физический принцип работы, например тепловые механизмы выполняют сжигание топлива и переработку его в тепло, механические используют энергию, передающуюся через вращения валов, паровые используют энергию пара для приведение в движение своих подвижных элементов, электрические механизмы могут разнообразным образом использовать электрическую энергию для выполнения полезной работы, ядерные используют энергию, выделяющуюся при распаде атомов некоторых веществ. Некоторые механизмы могут использовать энергию солнца, ветра, движения воды или геотермальную энергию для выполнения полезной работы. 

Механизмы позволяют строить автоматические цепочки по добыче, транспортировке, переработки ресурсов и изготовлению из них конечной продукции без участия игрока. Высокотехнологичные механизмы позволяют создавать системы автоматического управления для точного контроля определенных технологических процессов.

Механизмы могут взаимодействовать с друг другом c помощью конвейеров и труб для передачи предметов, механических валов, электрических проводов, паровых труб под давлением или труб с горячем теплоносителем для передачи энергии, проводной и радио-связи для передачи управляющих сигналов. Системы телеуправления и телемеханики позволяют управлять отдаленными производствами с единого центра управления.

Реализация конвейеров и труб схожа с GregTech (а не Factorio), в трубах дополнительно происходит моделирование давления. В электрической сети производиться моделирование напряжения и силы тока, а также потеря энергии при передачи по проводам, сеть рассчитывается законами Кирхгофа ищ электротехники, реактивное сопротивление (емкости и индуктивности) в расчетах не учитывается. 

---
© 2024 Вадим Бельский (bielski.vadim@gmail.com)